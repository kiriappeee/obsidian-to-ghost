{"version":3,"file":"main.js","sourceRoot":"","sources":["main.ts"],"names":[],"mappings":"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","sourcesContent":["import { App, Plugin, PluginSettingTab, Setting, Notice, request, TFile } from 'obsidian';\nimport { sign } from 'jsonwebtoken';\n\n// Define the settings interface\ninterface GhostPublisherSettings {\n  blogUrl: string;\n  writingFolderPath: string;\n  ghostApiKeyName: string; // New setting\n}\n\n// Define the default settings\nconst DEFAULT_SETTINGS: GhostPublisherSettings = {\n  blogUrl: '',\n  writingFolderPath: 'writing',\n  ghostApiKeyName: 'ghost-admin-api-key', // Default for new setting\n};\n\n// ADDED: JWT generation function\nfunction generateGhostAdminToken(apiKey: string): string | null {\n  const [id, secret] = apiKey.split(':');\n  if (!id || !secret) {\n    return null;\n  }\n  const token = sign({}, Buffer.from(secret, 'hex'), {\n    keyid: id,\n    algorithm: 'HS256',\n    expiresIn: '5m',\n    audience: '/admin/'\n  });\n  return token;\n}\n\nexport default class ObsidianToGhostPublisher extends Plugin {\n  settings!: GhostPublisherSettings;\n\n  async onload() {\n    console.log('loading Obsidian to Ghost Publisher plugin');\n\n    // Load settings\n    await this.loadSettings();\n\n    // Add the settings tab\n    this.addSettingTab(new GhostSettingsTab(this.app, this));\n\n    // Add a command to publish to Ghost\n    this.addCommand({\n      id: 'publish-to-ghost',\n      name: 'Publish to Ghost',\n      callback: async () => {\n        // 1. Get Settings\n        const { blogUrl, ghostApiKeyName } = this.settings;\n        if (!blogUrl || !ghostApiKeyName) {\n          new Notice('Blog URL and API Key Name must be set in settings.');\n          return;\n        }\n\n        try {\n          // 2. Get API Key\n          const apiKey = await this.app.secretStorage.getSecret(ghostApiKeyName);\n          if (!apiKey) {\n            new Notice(`API Key secret named '${ghostApiKeyName}' not found.`);\n            return;\n          }\n\n          // 3. Generate JWT\n          const token = generateGhostAdminToken(apiKey);\n          if (!token) {\n            new Notice('API Key is not in the correct format (id:secret).');\n            return;\n          }\n\n          // 4. Make API Request\n          const normalizedUrl = blogUrl.replace(/\\/$/, '');\n          const apiUrl = `${normalizedUrl}/ghost/api/admin/posts/`;\n\n          new Notice('Attempting to authenticate with Ghost...');\n          \n          const response = await request({\n            url: apiUrl,\n            method: 'GET',\n            headers: {\n              'Authorization': `Ghost ${token}`\n            }\n          });\n          \n          const responseData = JSON.parse(response);\n          \n          new Notice(`Successfully authenticated! Found ${responseData.posts.length} posts.`, 10000);\n          console.log('Ghost Posts:', responseData);\n\n        } catch (error) {\n          console.error('Error authenticating with Ghost:', error);\n          new Notice('Error authenticating with Ghost. Check settings and API key.', 10000);\n        }\n      },\n    });\n  }\n\n  onunload() {\n    console.log('unloading Obsidian to Ghost Publisher plugin');\n  }\n\n  async loadSettings() {\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n  }\n\n  async saveSettings() {\n    await this.saveData(this.settings);\n  }\n}\n\nclass GhostSettingsTab extends PluginSettingTab {\n  plugin: ObsidianToGhostPublisher;\n\n  constructor(app: App, plugin: ObsidianToGhostPublisher) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n\n  display(): void {\n    const { containerEl } = this;\n\n    containerEl.empty();\n\n    containerEl.createEl('h2', { text: 'Ghost Publisher Settings' });\n\n    new Setting(containerEl)\n      .setName('Blog URL')\n      .setDesc('The public URL of your Ghost blog (e.g., https://myblog.com)')\n      .addText(text => text\n        .setPlaceholder('https://myblog.com')\n        .setValue(this.plugin.settings.blogUrl)\n        .onChange(async (value) => {\n          this.plugin.settings.blogUrl = value;\n          await this.plugin.saveSettings();\n        }));\n\n    new Setting(containerEl)\n      .setName('Writing Folder Path')\n      .setDesc('The path to the root folder containing your drafts and published posts.')\n      .addText(text => text\n        .setPlaceholder('writing')\n        .setValue(this.plugin.settings.writingFolderPath)\n        .onChange(async (value) => {\n          this.plugin.settings.writingFolderPath = value;\n          await this.plugin.saveSettings();\n        }));\n\n    // New Setting for Ghost Admin API Key Secret Name\n    new Setting(containerEl)\n      .setName('Ghost Admin API Key Secret Name')\n      .setDesc('The name of the secret stored in Obsidian\\'s secure storage for your Ghost Admin API Key.')\n      .addText(text => text\n        .setPlaceholder(DEFAULT_SETTINGS.ghostApiKeyName)\n        .setValue(this.plugin.settings.ghostApiKeyName)\n        .onChange(async (value) => {\n          this.plugin.settings.ghostApiKeyName = value;\n          await this.plugin.saveSettings();\n        }));\n  }\n}\n"]}